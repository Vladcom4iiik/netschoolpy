# Вход через Госуслуги (ESIA)

`netschoolpy` поддерживает вход в дневник через единую систему идентификации и аутентификации (ЕСИА / Госуслуги).

## Как это работает?

В отличие от обычной авторизации (где вы вводите логин и пароль от NetSchool), здесь используется ваш аккаунт Госуслуг.

## Пример кода

Для входа через Госуслуги используйте метод `login_via_gosuslugi`.

```python
import asyncio
from netschoolpy import NetSchool

async def main():
    url = 'https://sgo.your-region.ru'  # Адрес вашего дневника
    
    async with NetSchool(url) as ns:
        # Вход через ESIA
        await ns.login_via_gosuslugi(
            'ваш_телефон_или_email',
            'пароль_от_госуслуг',
            school='Школа №1',  # если привязано несколько организаций
        )
        
        # После успешного входа можно получать данные как обычно
        diary = await ns.diary()
        print(f"Дневник получен! Уроков: {sum(len(d.lessons) for d in diary.schedule)}")

if __name__ == '__main__':
    asyncio.run(main())
```

!!! warning "Важно"
    Библиотека **не сохраняет** ваш логин и пароль. Они отправляются только на сервера Госуслуг для получения токена доступа.
    Если у вас включена **двухфакторная аутентификация (2FA)** на Госуслугах, библиотека поддерживает SMS, TOTP (приложение-аутентификатор) и MAX (Госключ). Код будет запрошен через `input()`.

### Выбор организации

Если к аккаунту Госуслуг привязано несколько организаций (школ), передайте параметр `school`:

```python
# Автоматический выбор по подстроке (без учёта регистра)
await ns.login_via_gosuslugi('логин', 'пароль', school='Лицей №5')

# Без school — интерактивный выбор через input()
await ns.login_via_gosuslugi('логин', 'пароль')
# К аккаунту привязано несколько организаций:
#   1. Иванов Иван (МОУ "Лицей №5", Саранск)
#   2. Иванов Иван (МБОУ "Школа №3", Рузаевка)
# Выберите организацию (1-2):
```

## Вход по QR-коду

Альтернативный способ — вход через QR-код без ввода логина/пароля:

```python
async def show_qr(qr_data: str):
    import qrcode
    qrcode.make(qr_data).save("qr.png")
    print("Отсканируйте QR в приложении Госуслуги!")

await ns.login_via_gosuslugi_qr(
    qr_callback=show_qr,
    school='Школа №1',  # если привязано несколько организаций
)
```

## Возможные проблемы

1.  **Неверный регион:** Убедитесь, что URL `NetSchool` (`https://sgo...`) поддерживает вход через Госуслуги (на странице входа должна быть кнопка «Войти через Госуслуги»).
2.  **Капча:** Если Госуслуги потребуют ввести капчу, библиотека выбросит исключение `LoginError`.
